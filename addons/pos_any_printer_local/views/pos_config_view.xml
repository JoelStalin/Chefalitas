<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="pos_config_view_form_inherit_local_printer" model="ir.ui.view">
            <field name="name">pos.config.form.inherit.local.printer</field>
            <field name="model">pos.config</field>
            <field name="inherit_id" ref="point_of_sale.pos_config_view_form"/>
            <field name="arch" type="xml">
                <!--
                    El XPath anterior falló. Este nuevo XPath busca el contenedor de configuración
                    de la impresora de la IoT Box de una manera más genérica.
                    Esto es más robusto ante cambios menores en la estructura de la vista.
                -->
                <xpath expr="//div[hasclass('o_setting_container')]//div[hasclass('o_setting_right_pane') and descendant::field[@name='iotbox_printer_ip']]" position="after">
                    <div class="col-12 col-lg-6 o_setting_box" id="local_printing_settings">
                        <div class="o_setting_left_pane">
                            <field name="enable_local_printing"/>
                        </div>
                        <div class="o_setting_right_pane">
                            <label for="enable_local_printing"/>
                            <div class="text-muted">
                                Permite la impresión directa a una impresora en la PC del cajero a través de un agente local.
                            </div>
                            <div class="content-group mt16" attrs="{'invisible': [('enable_local_printing', '=', False)]}">
                                <div class="row">
                                    <label class="col-lg-4 o_light_label" for="local_printer_name"/>
                                    <field name="local_printer_name" attrs="{'required': [('enable_local_printing', '=', True)]}"/>
                                </div>
                                <div class="mt16">
                                    <p class="o_form_label">
                                        Instale el agente en la PC del cajero para habilitar la conexión.
                                    </p>
                                    <a href="/pos_any_printer_local/static/download/LocalPrinterAgent-Setup.exe" class="btn btn-primary" download="LocalPrinterAgent-Setup.exe">
                                        <i class="fa fa-download"/> Descargar Agente (Windows)
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
